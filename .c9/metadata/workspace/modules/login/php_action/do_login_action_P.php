{"filter":false,"title":"do_login_action_P.php","tooltip":"/modules/login/php_action/do_login_action_P.php","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":35,"column":2},"action":"insert","lines":["<?php","    require_once 'include/php/action_listener.php';","    require_once 'include/php/event_message.php';","    require_once 'modules/user_profile/user_profile_api_P.php';","    ","    class do_login_action_P implements action_listener{","        public function actionPerformed(event_message $em) {","            $obj = user_profile_api_P::check_account($em);","            var_dump($obj);","            session_start();","            $post = $em->getPost();","            if($obj['data_set'][0]['id']!='' && $obj['data_set'][0]['id']!=null){","                $_SESSION['userid'] = $obj['data_set'][0]['id'];","                $_SESSION['user'] = $obj['data_set'][0]['name'];","                $_SESSION['useracc'] = $obj['data_set'][0]['account'];","            }","            $device_token_c = $post['device_token_c'];","            $device_token_e = $post['device_token_e'];","            $userid=$_SESSION['userid'];","            $user_profile_model=new user_profile_model();","            if($device_token_c != null){","                $user_profile_model->update_notice_key_c(\"'$device_token_c'\",$userid);","            }","            if($device_token_e != null){","                $user_profile_model->update_notice_key_e(\"'$device_token_e'\",$userid);","            }","            if($obj['status_code']== 0){ //0為登入成功 -100失敗(帳密錯誤)","                if($obj['data_set'][0]['id']==37){","                    $obj['status_code']= 1;","                }","            }","            $obj['ckey']=$device_token_c;","            return json_encode($obj);","        }        ","    }","?>"],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":35,"column":2},"action":"remove","lines":["<?php","    require_once 'include/php/action_listener.php';","    require_once 'include/php/event_message.php';","    require_once 'modules/user_profile/user_profile_api_P.php';","    ","    class do_login_action_P implements action_listener{","        public function actionPerformed(event_message $em) {","            $obj = user_profile_api_P::check_account($em);","            var_dump($obj);","            session_start();","            $post = $em->getPost();","            if($obj['data_set'][0]['id']!='' && $obj['data_set'][0]['id']!=null){","                $_SESSION['userid'] = $obj['data_set'][0]['id'];","                $_SESSION['user'] = $obj['data_set'][0]['name'];","                $_SESSION['useracc'] = $obj['data_set'][0]['account'];","            }","            $device_token_c = $post['device_token_c'];","            $device_token_e = $post['device_token_e'];","            $userid=$_SESSION['userid'];","            $user_profile_model=new user_profile_model();","            if($device_token_c != null){","                $user_profile_model->update_notice_key_c(\"'$device_token_c'\",$userid);","            }","            if($device_token_e != null){","                $user_profile_model->update_notice_key_e(\"'$device_token_e'\",$userid);","            }","            if($obj['status_code']== 0){ //0為登入成功 -100失敗(帳密錯誤)","                if($obj['data_set'][0]['id']==37){","                    $obj['status_code']= 1;","                }","            }","            $obj['ckey']=$device_token_c;","            return json_encode($obj);","        }        ","    }","?>"],"id":3}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1544124129413,"hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709"}