{"changed":true,"filter":false,"title":"building_show_management_page.js","tooltip":"/modules/building/js_action/building_show_management_page.js","value":"class building_show_management_page extends ActionHandler {\n    constructor(module, action, position_id) {\n        super(module, action);\n        this.position_id = position_id;\n    }\n    prepareArgs() {\n        // console.log('test');\n        this.php = true;\n        this.php_action = 'do_select_action';\n    }\n    ajax_success(json_str) {\n            $(document).ready(function(){\n                $(\"select[name='selectcons']\").change(function(){\n                var t = $(this).val();\n                // alert(t);\n                });\n                $(\"select[name='selectname']\").change(function(){\n                var c = $(this).val();\n                // alert(c);\n                });\n            });\n        try {\n            var json_str = json_str.responseText;\n            var obj = JSON.parse(json_str);\n            if (obj['status_code'] === 0) \n            var ds=obj['rctid'];\n            // console.log(ds);\n            var str=`\n            <div class=\"row mt-0\">\n            <div class=\"col-lg-12 col-md-7\">\n                <div class=\"w-100 p-2 borderB\">\n                    <h1 class=\"bold\">建案管理</h1>\n                </div>\n\n                <div>\n                    <span class=\"bold mr-2\">建案</span>`;\n                      str+='<select class=\"mdb-select md-form\" id=\"selectcons\" name=\"selectcons\"><option value=\"\" disabled selected>選擇建案...</option>';\n                      for (var index in ds) {\n                        str += '<option value=\"' + ds[index]['constructor']['id'] + '\">' + ds[index]['constructor']['name'] + '</option>';\n                        }\n                        str += '</select><span class=\"bold mr-2\">負責人</span><select class=\"mdb-select md-form\" id=\"selectname\" name=\"selectname\"><option value=\"\" disabled selected>選擇負責人...</option>';\n                        for (var index in ds) {\n                            for(var p in ds[index][1]){\n                                str += '<option value=\"' + ds[index][1][p]['id'] + '\">' + ds[index][1][p]['name'] + '</option>';\n                            }\n                            break;\n                        }\n                        \n                        \n             str+=`</select><button onclick=\"(new building_do_select_search_action_P('building','do_select_search_action_P','search')).run()\" class=\"btn btn-indigo btn-sm  mx-1\">搜尋</button>\n                    <button onclick =\"(new building_show_management_page('building','show_management_page','body1')).run()\" class=\"btn btn-indigo btn-sm mx-1\">清空</button>\n                    <button onclick=\"(new building_show_insert_page('building','show_insert_page','body1')).run()\" class=\"btn btn-indigo btn-sm\" type=\"button\">新增建案</button>\n                    <button onclick=\"(new building_show_M_setcomview_page('building','show_M_setcomview_page','body1')).run()\" class=\"btn btn-indigo btn-sm\" type=\"button\">編輯工務主任負責建案</button>\n                </div><div class=\"overFlow\">\n                    <table class=\"table text-center\">\n                        <thead>\n                            <tr>\n                                <th scope=\"col\" class=\"h5 px-2 bold py-2\">建案名稱</th>\n                                <th scope=\"col\" class=\"h5 px-0 bold py-2\">負責人</th>\n                                <th scope=\"col\" class=\"h5 px-0 bold py-2\">詳情</th>\n                                <th scope=\"col\" class=\"h5 px-0 bold py-2\">編輯</th>\n                                <th scope=\"col\" class=\"h5 px-0 bold py-2\">刪除</th>\n                            </tr>\n                        </thead>\n                        <tbody id=\"search\">\n                            <tr>`;\n                                \n                                for(var i in ds){\n                                    var string=\"\";\n                                        str+='<th class=\"py-2\">' + ds[i]['constructor']['name'] + '</th>';\n                                    for (var k in ds[i][0]) {\n                                        string+=ds[i][0][k]['name']+\" \";\n                                    }\n                                     str+='<td class=\"py-2 w-25\">'+string+'</td>';\n                                   \n                                \n                                \n                                str+=`<td class=\"py-0\">\n                                    <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n                                        \n                                         <a type=\"button\" class=\"btn bg-transparent p-2\" onclick=\"(new household_show_management_page_P('household','show_management_page_P','body1','${ds[i]['constructor']['id']}','${ds[i]['constructor']['name']}','${ds[i][0][k]['id']}','${ds[i][0][k]['name']}')).run()\">\n                                        \n                                    <i class=\"fa fa-building-o fa-lg text-dark\"></i>\n                                </a>\n                                    </div>\n                                </td>\n                                        \n                                \n                                <td class=\"py-0\">\n                                    <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n                                        \n                                         <a type=\"button\" class=\"btn bg-transparent p-2\" onclick=\"(new building_show_update_page_P('building','show_update_page_P','body1','${ds[i]['constructor']['id']}','${ds[i]['constructor']['name']}')).run()\">\n                                        \n                                    <i class=\"fa fa-pencil-square-o fa-lg text-dark\"></i>\n                                </a>\n                                    </div>\n                                </td>\n\n                                <td class=\"py-0\">\n                                    <div class=\"btn-group\" role=\"group\" aria-label=\"Basic example\">\n                                        <a type=\"button\" class=\"btn bg-transparent p-2\" onclick=\"(new building_do_delete_action_P('building','do_delete_action_P','body1','${ds[i]['constructor']['id']}')).run()\">\n                                    <i class=\"fa fa-close fa-lg text-dark\"></i>\n                                </a>\n                                    </div>\n                                </td>\n\n                            </tr>`;\n                                }\n                        str+=`</tobody>\n                    </table>\n                </div>\n            </div>\n            `;\n                $('#' + this.position_id).html(str);\n            \n        } catch (e) {\n            var msg = e + \"<br>\";\n            msg += \"JSON String: \" + json_str;\n            \n            // $('#' + this.position_id).html(msg);\n        }\n        $(document).ready(function() {\n        $('.mdb-select').material_select();\n        $('.caret').css('margin-top','-7px');\n        $('.select-dropdown').css('max-width','100%').css('margin','0').css('height','2rem');\n        $('.select-wrapper').css('display','inline-block').css('margin','0').css('max-width','200px');\n    }); \n        this.loadModuleScript(this.module, \"show_insert_page\");\n        this.loadModuleScript(this.module, \"do_delete_action_P\");\n        this.loadModuleScript(this.module, \"do_select_search_action_P\");\n        this.loadModuleScript(this.module, \"show_update_page_P\");\n        this.loadModuleScript(this.module, \"show_M_setcomview_page\");\n        this.loadModuleScript(\"household\", \"show_management_page_P\");\n    }\n    ajax_error(msg) {\n        // $('#' + this.position_id).html(msg.status);\n    }\n}","undoManager":{"mark":-2,"position":1,"stack":[[{"start":{"row":91,"column":170},"end":{"row":91,"column":171},"action":"insert","lines":[","],"id":2}],[{"start":{"row":91,"column":171},"end":{"row":91,"column":236},"action":"insert","lines":["'${ds[i]['constructor']['id']}','${ds[i]['constructor']['name']}'"],"id":3}]]},"ace":{"folds":[],"scrolltop":900,"scrollleft":0,"selection":{"start":{"row":91,"column":246},"end":{"row":91,"column":246},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1543546354653}